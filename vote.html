<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>å¹´ä¼šèŠ‚ç›®æŠ•ç¥¨</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<style>
body { font-family:"Microsoft YaHei", Arial; background:#f7f7f7; padding:20px; }
h2 { text-align:center; }
.box { background:#fff; padding:15px; border-radius:10px; margin-bottom:15px; }
button { width:100%; padding:12px; font-size:18px; background:#ff9800; color:#fff; border:none; border-radius:8px; }
</style>

<script>
/* ğŸ”¥ æ›¿æ¢æˆä½ è‡ªå·±çš„ Firebase é…ç½® */
const firebaseConfig = {
  apiKey: "AIzaSyA4LcWqtAhVbq0KDEmm2Hk0l-_me-dn-aY",
  authDomain: "vote-25c12.firebaseapp.com",
  projectId: "vote-25c12",
  storageBucket: "vote-25c12.firebasestorage.app",
  messagingSenderId: "344176299020",
  appId: "1:344176299020:web:3c68a76bf1df256978f229",
  measurementId: "G-JXQGZLRKVK"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

const programs = ["èˆè¹ˆ", "åˆå”±", "ç›¸å£°", "å°å“", "ä¹é˜Ÿ"];

function submitVote() {
  const name = document.getElementById("name").value.trim();
  if(!name){ alert("è¯·è¾“å…¥å§“å"); return; }

  const selected = [...document.querySelectorAll("input[type=checkbox]:checked")].map(i=>i.value);
  if(selected.length === 0){ alert("è¯·é€‰æ‹©èŠ‚ç›®"); return; }

  db.ref("users/"+name).once("value", snap=>{
    let voted = snap.val() || [];
    if(voted.length + selected.length > 2){ alert("æ¯äººæœ€å¤šåªèƒ½æŠ•2ç¥¨"); return; }

    selected.forEach(p=>{
      if(!voted.includes(p)){
        db.ref("votes/"+p).transaction(v => (v||0)+1);
        voted.push(p);
      }
    });
    db.ref("users/"+name).set(voted);
    alert("ğŸ‰ æŠ•ç¥¨æˆåŠŸï¼");
  });
}
</script>
</head>

<body>
<h2>ğŸ‰ å¹´ä¼šèŠ‚ç›®æŠ•ç¥¨ ğŸ‰</h2>

<div class="box">
å§“åï¼š<br>
<input id="name" style="width:100%; padding:10px; font-size:16px;">
</div>

<div class="box" id="programList"></div>

<button onclick="submitVote()">æäº¤æŠ•ç¥¨</button>

<script>
const list = document.getElementById("programList");
programs.forEach(p=>{
  list.innerHTML += `<div style="margin:8px 0;">
  <label><input type="checkbox" value="${p}"> ${p}</label>
  </div>`;
});
</script>
</body>
</html>
